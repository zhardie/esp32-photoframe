<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ESP32 PhotoFrame - Flash & Demo</title>
    <script
      type="module"
      src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js?module"
    ></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .icon {
        width: 64px;
        height: 64px;
      }

      .nav-tabs {
        display: flex;
        background: #f8f9fa;
        border-bottom: 2px solid #e0e0e0;
      }

      .nav-tab {
        flex: 1;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 500;
        color: #666;
        transition: all 0.3s;
        border-bottom: 3px solid transparent;
      }

      .nav-tab:hover {
        background: #e9ecef;
      }

      .nav-tab.active {
        color: #667eea;
        background: white;
        border-bottom-color: #667eea;
      }

      .tab-content {
        display: none;
        padding: 40px;
      }

      .tab-content.active {
        display: block;
      }

      .section {
        margin-bottom: 30px;
      }

      .section h2 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.5rem;
      }

      .section p,
      .section li {
        color: #666;
        line-height: 1.6;
        margin-bottom: 10px;
      }

      .section ul {
        margin-left: 20px;
      }

      .flash-container {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 30px;
        text-align: center;
        margin: 30px 0;
      }

      .flash-container h3 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.3rem;
      }

      esp-web-install-button {
        --esp-tools-button-color: #667eea;
        --esp-tools-button-text-color: white;
      }

      esp-web-install-button::part(button) {
        padding: 15px 40px;
        font-size: 1.1rem;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
      }

      esp-web-install-button::part(button):hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .requirements {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        border-radius: 4px;
        margin: 20px 0;
      }

      .requirements strong {
        color: #856404;
      }

      .requirements p {
        color: #856404;
        margin: 5px 0;
      }

      .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .feature-card {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
      }

      .feature-card h4 {
        color: #667eea;
        margin-bottom: 10px;
      }

      .feature-card p {
        color: #666;
        font-size: 0.9rem;
      }

      .info-banner {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 20px;
        border-radius: 4px;
        margin-bottom: 30px;
      }

      .info-banner h3 {
        color: #1976d2;
        margin-bottom: 10px;
      }

      .info-banner p {
        color: #0d47a1;
        line-height: 1.6;
      }

      .upload-area {
        border: 3px dashed #667eea;
        border-radius: 12px;
        padding: 60px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        background: #f8f9fa;
      }

      .upload-area:hover {
        background: #e9ecef;
        border-color: #764ba2;
      }

      .upload-area.drag-over {
        background: #e3f2fd;
        border-color: #2196f3;
      }

      .upload-icon {
        font-size: 3rem;
        margin-bottom: 15px;
      }

      .preview-section {
        margin-top: 30px;
      }

      /* Preset Selector */
      .preset-selector {
        background: white;
        border: 3px solid #667eea;
        border-radius: 12px;
        padding: 20px;
        margin: 0 auto 25px;
        max-width: 900px;
        text-align: center;
      }

      .preset-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #667eea;
        margin-bottom: 15px;
      }

      .preset-options-horizontal {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 30px;
        flex-wrap: wrap;
      }

      .preset-option-horizontal {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-size: 0.95rem;
        color: #333;
        transition: color 0.3s ease;
      }

      .preset-option-horizontal:hover {
        color: #667eea;
      }

      .preset-option-horizontal input[type="radio"] {
        margin-right: 8px;
        cursor: pointer;
        width: 18px;
        height: 18px;
        accent-color: #667eea;
      }

      .preset-option-horizontal input[type="radio"]:checked + span {
        color: #667eea;
        font-weight: 600;
      }

      .preset-hint {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e0e0e0;
      }

      .preset-hint small {
        font-size: 0.85rem;
        color: #666;
        line-height: 1.4;
      }

      .comparison-container {
        position: relative;
      }

      .comparison-wrapper {
        position: relative;
        display: inline-block;
        user-select: none;
      }

      .canvas-container {
        position: relative;
        display: inline-block;
        border: 2px solid #667eea;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      #enhancedCanvas {
        display: block;
        position: relative;
        z-index: 1;
      }

      #stockCanvas {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 2;
        clip-path: inset(0 70% 0 0);
      }

      .slider-container {
        position: absolute;
        top: 0;
        left: 30%;
        width: 3px;
        height: 100%;
        background: linear-gradient(
          180deg,
          rgba(102, 126, 234, 0.8) 0%,
          rgba(118, 75, 162, 0.8) 100%
        );
        cursor: ew-resize;
        z-index: 10;
        box-shadow: 0 0 8px rgba(102, 126, 234, 0.5);
        transition: box-shadow 0.2s ease;
      }

      .slider-container:hover {
        box-shadow: 0 0 12px rgba(102, 126, 234, 0.8);
      }

      .slider-handle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 44px;
        height: 44px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: white;
        border: 3px solid white;
        transition: all 0.2s ease;
      }

      .slider-handle:hover {
        transform: translate(-50%, -50%) scale(1.1);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
      }

      .comparison-labels {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        font-size: 0.9rem;
        color: #666;
      }

      .comparison-labels span {
        font-weight: 500;
      }

      .curve-canvas-wrapper {
        background: white;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        flex-shrink: 0;
        width: 300px;
      }

      #curveCanvas {
        border: 2px solid #667eea;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        background: white;
      }

      .preview-label {
        margin-top: 10px;
        color: #666;
        font-size: 0.9rem;
      }

      canvas {
        max-width: 100%;
        height: auto;
        border-radius: 4px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 500;
      }

      .form-group small {
        display: block;
        margin-top: 5px;
        color: #666;
        font-size: 0.85rem;
      }

      input[type="range"] {
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: #e0e0e0;
        outline: none;
        -webkit-appearance: none;
        appearance: none;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #667eea;
        cursor: pointer;
        transition: background 0.3s ease;
      }

      input[type="range"]::-webkit-slider-thumb:hover {
        background: #764ba2;
      }

      input[type="range"]::-moz-range-thumb {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #667eea;
        cursor: pointer;
        border: none;
        transition: background 0.3s ease;
      }

      input[type="range"]::-moz-range-thumb:hover {
        background: #764ba2;
      }

      .controls-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .button-group {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 30px;
      }

      .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 500;
      }

      .btn-primary {
        background: #667eea;
        color: white;
      }

      .btn-primary:hover {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
      }

      .footer {
        background: #f8f9fa;
        padding: 20px;
        text-align: center;
        color: #666;
      }

      .footer a {
        color: #667eea;
        text-decoration: none;
      }

      .footer a:hover {
        text-decoration: underline;
      }

      #version-info {
        color: #666;
        font-size: 0.9rem;
        margin-top: 10px;
      }

      .loading {
        color: #999;
      }

      @media (max-width: 768px) {
        .nav-tabs {
          flex-direction: column;
        }

        .comparison-container {
          flex-direction: column;
        }

        .curve-canvas-wrapper {
          width: 100%;
          max-width: 300px;
          margin: 0 auto;
        }

        .controls-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>
          <svg
            class="icon"
            viewBox="0 0 100 100"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect x="10" y="10" width="80" height="80" fill="#d4a574" rx="4" />
            <rect x="18" y="18" width="64" height="64" fill="#c9985e" rx="2" />
            <rect x="24" y="24" width="52" height="52" fill="#ecf0f1" rx="1" />
            <path
              d="M 24 60 L 38 45 L 48 52 L 62 38 L 76 55 L 76 76 L 24 76 Z"
              fill="#95a5a6"
            />
            <circle cx="62" cy="36" r="6" fill="#f39c12" />
            <rect
              x="12"
              y="12"
              width="3"
              height="30"
              fill="#e6c9a8"
              opacity="0.5"
              rx="1"
            />
          </svg>
          ESP32 PhotoFrame
        </h1>
        <p>Try the demo, then flash the firmware to your device</p>
      </div>

      <div class="nav-tabs">
        <div class="nav-tab active" data-tab="demo">üé® Interactive Demo</div>
        <div class="nav-tab" data-tab="flash">‚ö° Flash Firmware</div>
      </div>

      <!-- Demo Tab -->
      <div id="demo-tab" class="tab-content active">
        <div class="info-banner">
          <h3>‚ú® Interactive Comparison</h3>
          <p>
            Drag the slider to compare our enhanced algorithm (right) with the
            stock Waveshare algorithm (left). Our algorithm features S-curve
            tone mapping, saturation adjustment, and measured palette dithering
            for superior e-paper display quality.
          </p>
        </div>

        <div id="uploadArea">
          <div class="upload-area" id="dropZone">
            <div class="upload-icon">üì∏</div>
            <h3>Drop an image here or click to upload</h3>
            <p style="color: #666; margin-top: 10px">
              Supports JPEG and PNG files ‚Ä¢ Or try the sample image below
            </p>
            <input
              type="file"
              id="fileInput"
              accept="image/jpeg,image/png"
              style="display: none"
            />
          </div>
          <div
            id="fileName"
            style="margin-top: 10px; text-align: center; color: #666"
          ></div>
        </div>

        <div id="previewSection" class="preview-section">
          <p
            style="
              text-align: center;
              max-width: 900px;
              margin: 0 auto 30px;
              color: #555;
              line-height: 1.6;
            "
          >
            The stock algorithm uses theoretical RGB values that may look
            acceptable on computer displays, but when flashed onto the actual
            e-paper device, the colors appear washed out and image quality is
            significantly degraded. Our enhanced algorithm uses measured palette
            dithering for superior e-paper display quality.
          </p>

          <div
            style="
              display: flex;
              gap: 30px;
              justify-content: center;
              align-items: flex-start;
              flex-wrap: wrap;
              margin-bottom: 20px;
            "
          >
            <div
              class="comparison-container"
              style="flex: 0 0 auto; padding: 0; background: transparent"
            >
              <h3 style="text-align: center; margin-bottom: 15px; color: #333">
                Drag the slider to compare
              </h3>
              <div class="comparison-wrapper" id="comparisonWrapper">
                <div class="canvas-container">
                  <canvas id="enhancedCanvas"></canvas>
                  <canvas id="stockCanvas"></canvas>
                  <div class="slider-container" id="sliderContainer">
                    <div class="slider-handle">‚ü∑</div>
                  </div>
                </div>
              </div>
              <div class="comparison-labels">
                <span>‚Üê Stock (Waveshare)</span>
                <span>Enhanced (Ours) ‚Üí</span>
              </div>
            </div>

            <div
              style="
                flex: 0 0 auto;
                display: flex;
                flex-direction: column;
                gap: 20px;
              "
            >
              <div class="form-group" style="text-align: left">
                <label>Preview Rendering Palette:</label>
                <div style="margin-top: 8px">
                  <label style="display: block; margin-bottom: 5px">
                    <input
                      type="radio"
                      name="renderPalette"
                      value="measured"
                      checked
                      style="margin-right: 5px"
                    />
                    Measured (simulates device)
                  </label>
                  <label style="display: block">
                    <input
                      type="radio"
                      name="renderPalette"
                      value="theoretical"
                      style="margin-right: 5px"
                    />
                    Theoretical (pure RGB)
                  </label>
                </div>
                <small
                  >Toggle to see how theoretical palette looks on screen vs
                  device</small
                >
              </div>
              <div
                class="curve-canvas-wrapper"
                id="curveWrapper"
                style="display: flex; flex-direction: column; gap: 15px"
              >
                <div>
                  <canvas id="curveCanvas" width="300" height="300"></canvas>
                </div>

                <!-- S-Curve Controls (Advanced) - Under Curve Canvas -->
                <div
                  id="scurveControls"
                  style="
                    background: #f8f9fa;
                    padding: 15px;
                    border-radius: 8px;
                    border: 1px solid #e0e0e0;
                  "
                >
                  <div
                    style="
                      font-weight: 600;
                      margin-bottom: 12px;
                      color: #667eea;
                    "
                  >
                    S-Curve Parameters
                  </div>
                  <div style="display: flex; flex-direction: column; gap: 15px">
                    <div class="form-group">
                      <label for="scurveStrength"
                        >Strength: <span id="strengthValue">0.9</span></label
                      >
                      <input
                        type="range"
                        id="scurveStrength"
                        min="0"
                        max="1"
                        step="0.1"
                        value="0.9"
                      />
                      <small
                        >Overall tone mapping strength (0=linear,
                        1=strong)</small
                      >
                    </div>

                    <div class="form-group">
                      <label for="scurveShadow"
                        >Shadow Boost: <span id="shadowValue">0.0</span></label
                      >
                      <input
                        type="range"
                        id="scurveShadow"
                        min="0"
                        max="1"
                        step="0.1"
                        value="0.0"
                      />
                      <small>Brighten shadow areas (higher=brighter)</small>
                    </div>

                    <div class="form-group">
                      <label for="scurveHighlight"
                        >Highlight Compress:
                        <span id="highlightValue">1.7</span></label
                      >
                      <input
                        type="range"
                        id="scurveHighlight"
                        min="0.5"
                        max="5"
                        step="0.1"
                        value="1.7"
                      />
                      <small
                        >Protect highlights from over-exposure (higher=more
                        protection)</small
                      >
                    </div>

                    <div class="form-group">
                      <label for="scurveMidpoint"
                        >Midpoint: <span id="midpointValue">0.5</span></label
                      >
                      <input
                        type="range"
                        id="scurveMidpoint"
                        min="0.3"
                        max="0.7"
                        step="0.05"
                        value="0.5"
                      />
                      <small>Where to split shadows/highlights</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Preset Selection -->
          <div class="preset-selector">
            <div class="preset-title">Processing Preset</div>
            <div class="preset-options-horizontal">
              <label class="preset-option-horizontal">
                <input type="radio" name="preset" value="cdr" checked />
                <span>Compressed Dynamic Range</span>
              </label>
              <label class="preset-option-horizontal">
                <input type="radio" name="preset" value="scurve" />
                <span>S-Curve</span>
              </label>
              <label class="preset-option-horizontal">
                <input type="radio" name="preset" value="custom" />
                <span>Custom</span>
              </label>
            </div>
            <div class="preset-hint">
              <small id="presetHintText"
                >Prevents over-exposure and generates good image quality for all
                images. Images will have a slightly darker look.</small
              >
            </div>
          </div>

          <div id="controlsGrid">
            <!-- Row 1: Color Matching Method & Dithering Algorithm -->
            <div class="controls-grid" style="margin-bottom: 20px">
              <div class="form-group">
                <label>Color Matching Method:</label>
                <div style="margin-top: 8px">
                  <label style="display: block; margin-bottom: 5px">
                    <input
                      type="radio"
                      name="colorMethod"
                      value="rgb"
                      checked
                      style="margin-right: 5px"
                    />
                    Simple RGB (default)
                  </label>
                  <label style="display: block">
                    <input
                      type="radio"
                      name="colorMethod"
                      value="lab"
                      style="margin-right: 5px"
                    />
                    LAB Color Space (better for grayscale)
                  </label>
                </div>
              </div>

              <div class="form-group" id="ditherAlgorithmControl">
                <label>Dithering Algorithm:</label>
                <div style="margin-top: 8px">
                  <label style="display: block; margin-bottom: 5px">
                    <input
                      type="radio"
                      name="ditherAlgorithm"
                      value="floyd-steinberg"
                      checked
                      style="margin-right: 5px"
                    />
                    Floyd-Steinberg (default)
                  </label>
                  <label style="display: block; margin-bottom: 5px">
                    <input
                      type="radio"
                      name="ditherAlgorithm"
                      value="stucki"
                      style="margin-right: 5px"
                    />
                    Stucki (smoother)
                  </label>
                  <label style="display: block; margin-bottom: 5px">
                    <input
                      type="radio"
                      name="ditherAlgorithm"
                      value="burkes"
                      style="margin-right: 5px"
                    />
                    Burkes (balanced)
                  </label>
                  <label style="display: block">
                    <input
                      type="radio"
                      name="ditherAlgorithm"
                      value="sierra"
                      style="margin-right: 5px"
                    />
                    Sierra (detailed)
                  </label>
                </div>
                <small>Note: Stock mode always uses Floyd-Steinberg</small>
              </div>

              <div class="form-group">
                <label>
                  <input
                    type="checkbox"
                    id="compressDynamicRange"
                    checked
                    style="margin-right: 5px"
                  />
                  Compress Dynamic Range
                </label>
                <small
                  >Map brightness range to display's actual white point to
                  prevent overexposure</small
                >
              </div>
            </div>

            <!-- Row 2: Exposure & Saturation -->
            <div class="controls-grid" style="margin-bottom: 20px">
              <div class="form-group">
                <label for="exposure"
                  >Exposure: <span id="exposureValue">1.0</span></label
                >
                <input
                  type="range"
                  id="exposure"
                  min="0.5"
                  max="2.0"
                  step="0.1"
                  value="1.0"
                />
                <small>Overall brightness (1.0=normal, >1.0=brighter)</small>
              </div>

              <div class="form-group">
                <label for="saturation"
                  >Saturation: <span id="saturationValue">1.3</span></label
                >
                <input
                  type="range"
                  id="saturation"
                  min="0.5"
                  max="2"
                  step="0.1"
                  value="1.3"
                />
                <small>Color vibrancy (1.0=normal, >1.0=more vibrant)</small>
              </div>
            </div>

            <!-- Row 3: Tone Mapping Selection and Contrast Control -->
            <div class="controls-grid" style="margin-bottom: 20px">
              <div class="form-group">
                <label>Tone Mapping:</label>
                <div style="margin-top: 8px">
                  <label style="display: block; margin-bottom: 5px">
                    <input
                      type="radio"
                      name="toneMode"
                      value="scurve"
                      checked
                      style="margin-right: 5px"
                    />
                    S-Curve (Advanced)
                  </label>
                  <label style="display: block">
                    <input
                      type="radio"
                      name="toneMode"
                      value="contrast"
                      style="margin-right: 5px"
                    />
                    Contrast (Simple)
                  </label>
                </div>
              </div>

              <!-- Contrast Control (Simple) -->
              <div
                id="contrastControl"
                class="form-group"
                style="display: none"
              >
                <label for="contrast"
                  >Contrast: <span id="contrastValue">1.0</span></label
                >
                <input
                  type="range"
                  id="contrast"
                  min="0.5"
                  max="2.0"
                  step="0.1"
                  value="1.0"
                />
                <small>Tonal range (1.0=normal, >1.0=more contrast)</small>
              </div>
            </div>
          </div>

          <div class="button-group">
            <button type="button" id="resetParams" class="btn btn-secondary">
              Reset to Defaults
            </button>
            <button type="button" id="newImage" class="btn btn-primary">
              Upload New Image
            </button>
          </div>
        </div>
      </div>

      <!-- Flash Tab -->
      <div id="flash-tab" class="tab-content">
        <div class="section">
          <h2>About</h2>
          <p>
            A modern firmware for the Waveshare ESP32-S3-PhotoPainter that
            provides a powerful RESTful API and web interface for managing your
            e-paper photo frame.
          </p>
        </div>

        <div class="feature-grid">
          <div class="feature-card">
            <h4>üì∏ Smart Upload</h4>
            <p>Drag & drop JPEG files with automatic processing</p>
          </div>
          <div class="feature-card">
            <h4>üîÑ Auto-Rotate</h4>
            <p>Automatic image rotation with configurable intervals</p>
          </div>
          <div class="feature-card">
            <h4>üîã Power Smart</h4>
            <p>2-minute auto-sleep with battery monitoring</p>
          </div>
          <div class="feature-card">
            <h4>üì± Web Control</h4>
            <p>Modern web interface with real-time updates</p>
          </div>
        </div>

        <div class="requirements">
          <strong>‚ö†Ô∏è Requirements:</strong>
          <p>‚Ä¢ Chrome, Edge, or Opera browser (Web Serial API required)</p>
          <p>‚Ä¢ USB-C cable connected to your ESP32-S3-PhotoPainter</p>
          <p>‚Ä¢ Waveshare ESP32-S3-PhotoPainter device</p>
        </div>

        <div class="flash-container">
          <h3>Flash Firmware</h3>

          <div
            style="
              margin-bottom: 20px;
              text-align: center;
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 12px;
            "
          >
            <label for="version-select" style="font-weight: 500"
              >Version:</label
            >
            <select
              id="version-select"
              style="
                padding: 8px 12px;
                font-size: 1rem;
                border: 2px solid #667eea;
                border-radius: 4px;
                background: white;
                cursor: pointer;
                min-width: 250px;
              "
            >
              <option value="stable">Stable Release (loading...)</option>
              <option value="dev">
                Development (Latest Main Branch) (loading...)
              </option>
            </select>
          </div>

          <br />
          <esp-web-install-button
            id="install-button"
            manifest="./manifest.json"
          >
            <button slot="activate">Connect & Flash</button>
          </esp-web-install-button>

          <p
            id="version-warning"
            style="
              display: none;
              color: #856404;
              margin-top: 15px;
              font-size: 0.9rem;
            "
          >
            ‚ö†Ô∏è <strong>Development builds</strong> are bleeding-edge and may
            contain bugs. Use stable releases for production.
          </p>
        </div>

        <div class="section">
          <h2>Instructions</h2>
          <ul>
            <li>
              <strong>Step 1:</strong> Connect your ESP32-S3-PhotoPainter to
              your computer via USB-C
            </li>
            <li>
              <strong>Step 2:</strong> Click the "Connect & Flash" button above
            </li>
            <li>
              <strong>Step 3:</strong> Select the correct serial port from the
              popup
            </li>
            <li>
              <strong>Step 4:</strong> Wait for the flashing process to complete
              (~2 minutes)
            </li>
            <li>
              <strong>Step 5:</strong> Configure WiFi using Improv (automatic
              prompt) or AP mode
            </li>
          </ul>
        </div>

        <div
          class="section"
          style="
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
          "
        >
          <h2 style="color: #856404">‚ö†Ô∏è Device Not Detected?</h2>
          <p style="color: #856404; margin-bottom: 10px">
            This firmware has <strong>automatic light sleep</strong> enabled for
            power saving. If your device is not detected when you click "Connect
            & Flash":
          </p>
          <ol style="color: #856404; margin-left: 20px">
            <li>
              <strong>Press and hold the PWR button for 5 seconds</strong>
              (until device powers off)
            </li>
            <li>
              <strong
                >Hold down the BOOT button and click the PWR button</strong
              >
              to enter download mode
            </li>
            <li>
              <strong>Click "Connect & Flash"</strong> while in download mode
            </li>
          </ol>
          <p style="color: #856404; margin-top: 10px; font-size: 0.95em">
            üí° The device will remain in download mode and be detectable for
            flashing.
          </p>
        </div>

        <div class="section">
          <h2>üì° WiFi Setup Options</h2>
          <p>
            After flashing, you have two options to configure WiFi credentials:
          </p>
        </div>

        <div class="info-banner">
          <h3>Option 1: SD Card Provisioning (Recommended)</h3>
          <p>
            Create a file named <strong>wifi.txt</strong> on your SD card with
            the following format:
          </p>
          <p
            style="
              margin-top: 10px;
              font-family: monospace;
              background: rgba(0, 0, 0, 0.1);
              padding: 10px;
              border-radius: 4px;
            "
          >
            Line 1: Your WiFi SSID<br />
            Line 2: Your WiFi Password
          </p>
          <p style="margin-top: 10px">
            Insert the SD card and restart the device. It will automatically
            connect to your WiFi network.
          </p>
        </div>

        <div
          class="info-banner"
          style="background: #f8f9fa; border-left: 4px solid #667eea"
        >
          <h3>Option 2: AP Mode Setup</h3>
          <p>
            If no WiFi credentials are found, the device will create a WiFi
            access point named
            <strong>PhotoFrame-Setup</strong>. Connect to it and navigate to
            <strong>http://192.168.4.1</strong> to configure your WiFi
            credentials through the captive portal.
          </p>
        </div>
      </div>

      <div class="footer">
        <p>
          <a href="https://github.com/aitjcize/esp32-photoframe" target="_blank"
            >GitHub Repository</a
          >
          ‚Ä¢
          <a
            href="https://github.com/aitjcize/esp32-photoframe/releases"
            target="_blank"
            >Manual Download</a
          >
          ‚Ä¢
          <a
            href="https://www.waveshare.com/wiki/ESP32-S3-PhotoPainter"
            target="_blank"
            >Hardware Info</a
          >
        </p>
      </div>
    </div>
    <script type="module" src="/demo.js"></script>
  </body>
</html>
